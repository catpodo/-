<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Campfire</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    html, body {
        margin: 0;
        background: black;
        overflow: hidden;
    }
    #wrap {
        position: relative;
        width: 100vw;
        height: 100vh;
    }
    #bg {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    canvas {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    #hint {
        position: absolute;
        bottom: 10px;
        width: 100%;
        text-align: center;
        color: #ccc;
        font-size: 12px;
        opacity: 0.6;
    }
</style>
</head>

<body>
<div id="wrap">
    <img id="bg" src="image.jpg">
    <canvas id="fire"></canvas>
    <div id="hint">화면을 한 번 터치하면 불꽃 소리가 시작됩니다</div>
</div>

<audio id="sound" src="fire.mp3" loop></audio>

<script>
const canvas = document.getElementById("fire");
const ctx = canvas.getContext("2d");
const audio = document.getElementById("sound");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// 불꽃 파티클
const flames = [];

function spawnFlame() {
    flames.push({
        x: canvas.width * 0.55 + (Math.random() - 0.5) * 40,
        y: canvas.height * 0.72,
        r: 6 + Math.random() * 6,
        vy: 0.6 + Math.random() * 0.6,
        life: 1
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (Math.random() < 0.7) spawnFlame();

    for (let i = flames.length - 1; i >= 0; i--) {
        const f = flames[i];
        f.y -= f.vy;
        f.life -= 0.015;

        const grad = ctx.createRadialGradient(
            f.x, f.y, 0,
            f.x, f.y, f.r * 3
        );
        grad.addColorStop(0, `rgba(255,200,80,${f.life})`);
        grad.addColorStop(1, "rgba(255,120,0,0)");

        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.r * 3, 0, Math.PI * 2);
        ctx.fill();

        if (f.life <= 0) flames.splice(i, 1);
    }

    requestAnimationFrame(draw);
}
draw();

// Safari 오디오 정책 대응
document.body.addEventListener("click", () => {
    audio.volume = 0.25;
    audio.play();
    document.getElementById("hint").style.display = "none";
}, { once: true });
</script>
</body>
</html>
