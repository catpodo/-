<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ğŸ”¥ ë¶ˆê½ƒ íƒ€ì´ë°</title>
  <style>
    :root { --bg:#0b0f14; --card:#111826; --text:#e8eef7; --muted:#93a4bd; }
    html,body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",system-ui,sans-serif; }
    .wrap { max-width:720px; margin:0 auto; padding:16px 14px 22px; }
    .title { display:flex; align-items:baseline; justify-content:space-between; gap:12px; }
    .title h1 { margin:0; font-size:18px; font-weight:800; letter-spacing:-0.2px; }
    .title .sub { font-size:12px; color:var(--muted); }
    .card { background:var(--card); border-radius:18px; padding:14px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    canvas { width:100%; height:auto; border-radius:14px; background: radial-gradient(120% 120% at 50% 10%, rgba(255,180,60,.12), rgba(0,0,0,0) 55%), linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0)); display:block; }
    .hud { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:10px; }
    .pill { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:8px 10px; border-radius:999px; font-size:12px; color:var(--text); }
    .pill b { font-size:13px; }
    .btnrow { display:flex; gap:10px; margin-top:12px; }
    button {
      flex:1; border:0; border-radius:14px; padding:12px 14px; font-weight:800; font-size:14px;
      background: rgba(255,255,255,.08); color:var(--text); border:1px solid rgba(255,255,255,.1);
      touch-action: manipulation;
    }
    button.primary { background: rgba(255,180,60,.18); border-color: rgba(255,180,60,.28); }
    .hint { margin-top:10px; font-size:12px; color:var(--muted); line-height:1.45; }
    .hint kbd { background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.1); border-bottom-width:2px; padding:2px 6px; border-radius:8px; color:var(--text); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>ğŸ”¥ ë¶ˆê½ƒ íƒ€ì´ë°</h1>
      <div class="sub">ì´ˆë¡ êµ¬ê°„ì— ë§ì¶° íƒ­!</div>
    </div>

    <div class="card">
      <canvas id="c" width="900" height="560"></canvas>

      <div class="hud">
        <div class="pill">ì ìˆ˜ <b id="score">0</b></div>
        <div class="pill">ì½¤ë³´ <b id="combo">0</b></div>
        <div class="pill">ë¼ì´í”„ <b id="life">3</b></div>
        <div class="pill">ë‚œì´ë„ <b id="diff">1</b></div>
      </div>

      <div class="btnrow">
        <button class="primary" id="startBtn">ì‹œì‘ / ì¬ì‹œì‘</button>
        <button id="muteBtn">ì‚¬ìš´ë“œ: OFF</button>
      </div>

      <div class="hint">
        í™”ë©´ì„ <kbd>íƒ­</kbd>í•˜ë©´ íŒì •!<br/>
        - ì´ˆë¡: Perfect / ë…¸ë‘: Good / ê·¸ ì™¸: Miss<br/>
        - iOSëŠ” ë¬´ìŒì¼ ìˆ˜ ìˆì–´(ì‚¬ìš´ë“œ ON í›„ ì²« íƒ­ í•„ìš”)
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const scoreEl = document.getElementById('score');
  const comboEl = document.getElementById('combo');
  const lifeEl  = document.getElementById('life');
  const diffEl  = document.getElementById('diff');

  const startBtn = document.getElementById('startBtn');
  const muteBtn  = document.getElementById('muteBtn');

  // --- audio (tiny beeps) ---
  let audioOn = false;
  let audioCtx = null;
  function ensureAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
  }
  function beep(freq=440, ms=70, type='sine', gain=0.03) {
    if (!audioOn) return;
    ensureAudio();
    const t0 = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(gain, t0 + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t0 + ms/1000);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(t0); o.stop(t0 + ms/1000 + 0.02);
  }
  function vibrate(ms=20) {
    if (navigator.vibrate) navigator.vibrate(ms);
  }

  // --- game state ---
  let running = false;
  let lastT = 0;
  let score = 0;
  let combo = 0;
  let life  = 3;

  // timing meter: value 0..1 bouncing
  let v = 0.0;        // meter position
  let dir = 1;        // +1 or -1
  let speed = 0.55;   // base speed, increases with difficulty
  let diff = 1;

  // target zones (centered)
  function zones() {
    // as diff increases, perfect zone gets smaller
    const perfectW = Math.max(0.06, 0.14 - diff*0.012);
    const goodW    = Math.max(0.12, 0.26 - diff*0.016);
    return { perfectW, goodW, center: 0.5 };
  }

  function reset() {
    running = true;
    lastT = performance.now();
    score = 0; combo = 0; life = 3;
    v = Math.random()*0.8 + 0.1;
    dir = Math.random() < 0.5 ? 1 : -1;
    diff = 1;
    speed = 0.55;
    syncHUD();
  }

  function syncHUD() {
    scoreEl.textContent = score;
    comboEl.textContent = combo;
    lifeEl.textContent  = life;
    diffEl.textContent  = diff;
  }

  function clamp01(x){ return Math.max(0, Math.min(1, x)); }

  function update(dt) {
    // increase difficulty slowly with score
    const newDiff = 1 + Math.floor(score / 400);
    if (newDiff !== diff) {
      diff = newDiff;
      speed = 0.55 + (diff-1)*0.09;
      syncHUD();
      beep(520, 60, 'triangle', 0.02);
    }

    v += dir * speed * dt;
    if (v >= 1) { v = 1; dir = -1; }
    if (v <= 0) { v = 0; dir =  1; }
  }

  function judge() {
    if (!running) return;

    const { perfectW, goodW, center } = zones();
    const d = Math.abs(v - center);

    let result = 'miss';
    let add = 0;

    if (d <= perfectW/2) { result = 'perfect'; add = 120; }
    else if (d <= goodW/2) { result = 'good'; add = 60; }

    if (result === 'perfect') {
      combo += 1;
      const bonus = Math.min(120, combo * 6);
      score += add + bonus;
      beep(880, 60, 'sine', 0.03);
      vibrate(14);
    } else if (result === 'good') {
      combo += 1;
      const bonus = Math.min(80, combo * 4);
      score += add + bonus;
      beep(660, 70, 'sine', 0.02);
      vibrate(10);
    } else {
      combo = 0;
      life -= 1;
      beep(180, 130, 'sawtooth', 0.02);
      vibrate(35);
      if (life <= 0) running = false;
    }

    syncHUD();
    flash(result);
  }

  // simple flash feedback
  let flashT = 0;
  let flashKind = '';
  function flash(kind) {
    flashT = 0.18;
    flashKind = kind;
  }

  function draw() {
    const W = canvas.width, H = canvas.height;
    ctx.clearRect(0,0,W,H);

    // background embers
    for (let i=0;i<28;i++){
      const x = (i*97 + (performance.now()*0.03)) % (W+120) - 60;
      const y = H*0.7 + Math.sin(i*1.7 + performance.now()*0.002)*45 + (i%7)*6;
      const r = 2 + (i%5);
      ctx.globalAlpha = 0.10;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle="#ffb44a"; ctx.fill();
    }
    ctx.globalAlpha = 1;

    // title / status
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.font = "800 36px system-ui, -apple-system, sans-serif";
    ctx.fillText(running ? "íƒ­!" : "ê²Œì„ ì˜¤ë²„", 34, 64);
    ctx.fillStyle = "rgba(255,255,255,0.55)";
    ctx.font = "500 18px system-ui, -apple-system, sans-serif";
    ctx.fillText(running ? "ì´ˆë¡ êµ¬ê°„ì„ ë§ì¶”ë©´ ìµœê³  ì ìˆ˜" : "ì‹œì‘/ì¬ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ!", 34, 92);

    // meter bar
    const barX = 60, barY = 140, barW = W-120, barH = 54;
    roundRect(barX, barY, barW, barH, 16, "rgba(255,255,255,0.08)", "rgba(255,255,255,0.12)");

    const { perfectW, goodW, center } = zones();
    // zones
    const centerX = barX + barW*center;
    const goodX = centerX - (barW*goodW)/2;
    const perfX = centerX - (barW*perfectW)/2;

    // good zone (yellow)
    ctx.globalAlpha = 0.9;
    ctx.fillStyle = "rgba(255, 210, 80, 0.22)";
    roundFill(goodX, barY+7, barW*goodW, barH-14, 12);
    // perfect zone (green)
    ctx.fillStyle = "rgba(90, 240, 140, 0.28)";
    roundFill(perfX, barY+7, barW*perfectW, barH-14, 12);
    ctx.globalAlpha = 1;

    // moving marker (flame)
    const mx = barX + barW*v;
    const my = barY + barH/2;
    drawFlame(mx, my, 26 + Math.sin(performance.now()*0.01)*2);

    // instruction panel
    const boxX=60, boxY=240, boxW=W-120, boxH=260;
    roundRect(boxX, boxY, boxW, boxH, 18, "rgba(0,0,0,0.20)", "rgba(255,255,255,0.10)");
    ctx.fillStyle = "rgba(255,255,255,0.86)";
    ctx.font = "800 22px system-ui, -apple-system, sans-serif";
    ctx.fillText("ê·œì¹™", boxX+20, boxY+44);
    ctx.fillStyle = "rgba(255,255,255,0.65)";
    ctx.font = "500 18px system-ui, -apple-system, sans-serif";
    ctx.fillText("â€¢ ì´ˆë¡: Perfect (í° ì ìˆ˜ + ì½¤ë³´ ë³´ë„ˆìŠ¤)", boxX+20, boxY+78);
    ctx.fillText("â€¢ ë…¸ë‘: Good (ì¤‘ê°„ ì ìˆ˜ + ì½¤ë³´)", boxX+20, boxY+108);
    ctx.fillText("â€¢ ê·¸ ì™¸: Miss (ë¼ì´í”„ -1, ì½¤ë³´ ë¦¬ì…‹)", boxX+20, boxY+138);
    ctx.fillText("â€¢ ì ìˆ˜ê°€ ì˜¤ë¥´ë©´ ë‚œì´ë„â†‘ (ì´ˆë¡ êµ¬ê°„ì´ ì¢ì•„ì§)", boxX+20, boxY+168);
    ctx.fillText("â€¢ í™”ë©´ ì–´ë””ë“  íƒ­í•´ì„œ íŒì •!", boxX+20, boxY+208);

    // flash feedback
    if (flashT > 0) {
      const a = clamp01(flashT / 0.18);
      ctx.globalAlpha = a;
      let text = flashKind.toUpperCase();
      let fill = "rgba(255,255,255,0.92)";
      if (flashKind === 'perfect') fill = "rgba(90,240,140,0.95)";
      if (flashKind === 'good') fill = "rgba(255,210,80,0.95)";
      if (flashKind === 'miss') fill = "rgba(255,120,120,0.95)";
      ctx.fillStyle = fill;
      ctx.font = "900 54px system-ui, -apple-system, sans-serif";
      const tw = ctx.measureText(text).width;
      ctx.fillText(text, (W-tw)/2, 210);
      ctx.globalAlpha = 1;
    }

    // tap hint overlay when not running
    if (!running) {
      ctx.globalAlpha = 0.25;
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,W,H);
      ctx.globalAlpha = 1;

      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.font = "900 52px system-ui, -apple-system, sans-serif";
      const t = "GAME OVER";
      ctx.fillText(t, (W-ctx.measureText(t).width)/2, H*0.45);

      ctx.fillStyle = "rgba(255,255,255,0.70)";
      ctx.font = "700 24px system-ui, -apple-system, sans-serif";
      const s = `ìµœì¢… ì ìˆ˜: ${score}`;
      ctx.fillText(s, (W-ctx.measureText(s).width)/2, H*0.45 + 44);

      ctx.fillStyle = "rgba(255,255,255,0.55)";
      ctx.font = "600 18px system-ui, -apple-system, sans-serif";
      const s2 = "ì•„ë˜ â€˜ì‹œì‘/ì¬ì‹œì‘â€™ì„ ëˆŒëŸ¬ ë‹¤ì‹œ!";
      ctx.fillText(s2, (W-ctx.measureText(s2).width)/2, H*0.45 + 78);
    }
  }

  function roundFill(x,y,w,h,r){
    ctx.beginPath();
    roundedPath(x,y,w,h,r);
    ctx.fill();
  }
  function roundRect(x,y,w,h,r,fill,stroke){
    ctx.beginPath();
    roundedPath(x,y,w,h,r);
    ctx.fillStyle = fill; ctx.fill();
    ctx.strokeStyle = stroke; ctx.lineWidth = 2; ctx.stroke();
  }
  function roundedPath(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  function drawFlame(x,y,size){
    // outer glow
    ctx.save();
    ctx.translate(x,y);
    const wob = Math.sin(performance.now()*0.01)*0.08;
    ctx.rotate(wob);

    ctx.globalAlpha = 0.75;
    ctx.beginPath();
    ctx.ellipse(0, 0, size*0.62, size*0.38, 0, 0, Math.PI*2);
    ctx.fillStyle = "rgba(255,180,60,0.35)";
    ctx.fill();

    // flame body
    ctx.globalAlpha = 1;
    ctx.beginPath();
    ctx.moveTo(0, -size*1.05);
    ctx.bezierCurveTo(size*0.65, -size*0.55, size*0.75, size*0.35, 0, size*0.65);
    ctx.bezierCurveTo(-size*0.75, size*0.35, -size*0.65, -size*0.55, 0, -size*1.05);
    ctx.closePath();
    ctx.fillStyle = "rgba(255,180,60,0.92)";
    ctx.fill();

    // inner flame
    ctx.beginPath();
    ctx.moveTo(0, -size*0.72);
    ctx.bezierCurveTo(size*0.38, -size*0.35, size*0.42, size*0.22, 0, size*0.40);
    ctx.bezierCurveTo(-size*0.42, size*0.22, -size*0.38, -size*0.35, 0, -size*0.72);
    ctx.closePath();
    ctx.fillStyle = "rgba(255,245,200,0.88)";
    ctx.fill();

    // marker line
    ctx.globalAlpha = 0.22;
    ctx.fillStyle = "#fff";
    ctx.fillRect(-2, -40, 4, 80);

    ctx.restore();
  }

  function loop(t){
    const dt = Math.min(0.033, (t - lastT) / 1000);
    lastT = t;

    if (running) {
      update(dt);
      if (flashT > 0) flashT = Math.max(0, flashT - dt);
    } else {
      if (flashT > 0) flashT = Math.max(0, flashT - dt);
    }

    draw();
    requestAnimationFrame(loop);
  }

  // input
  function onTap(e){
    // prevent double-tap zoom on iOS
    e.preventDefault();
    if (audioOn) ensureAudio();
    judge();
  }
  canvas.addEventListener('pointerdown', onTap, { passive:false });
  canvas.addEventListener('touchstart', onTap, { passive:false });

  startBtn.addEventListener('click', () => {
    ensureAudio(); // allow audio init by user gesture
    reset();
  });

  muteBtn.addEventListener('click', () => {
    audioOn = !audioOn;
    muteBtn.textContent = `ì‚¬ìš´ë“œ: ${audioOn ? 'ON' : 'OFF'}`;
    if (audioOn) {
      ensureAudio();
      beep(520, 80, 'triangle', 0.02);
    }
  });

  // start idle loop
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
